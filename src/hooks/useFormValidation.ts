import { useCallback } from 'react';
import { CustomerFormData, CreditCardData } from '@/types/checkout';
import { FORM_FIELDS } from '@/constants';

export const useFormValidation = () => {
  const validateFormData = useCallback((formData: CustomerFormData, requiredFields: string[]) => {
    const missingFields = requiredFields.filter(field => {
      const fieldMap: Record<string, keyof CustomerFormData> = {
        [FORM_FIELDS.NAME]: 'nome',
        [FORM_FIELDS.EMAIL]: 'email', 
        [FORM_FIELDS.PHONE]: 'telefone',
        [FORM_FIELDS.CPF]: 'cpf'
      };
      return !formData[fieldMap[field]];
    });
    
    if (missingFields.length > 0) {
      throw new Error(`Preencha os seguintes campos obrigat√≥rios: ${missingFields.join(', ')}`);
    }
  }, []);

  const validateCreditCardData = useCallback((creditCardData: CreditCardData) => {
    console.log('üîç Validando dados do cart√£o...');
    console.log('üìã Dados do cart√£o recebidos:', {
      numero: creditCardData.numero ? `****${creditCardData.numero.slice(-4)}` : 'VAZIO',
      nome: creditCardData.nome || 'VAZIO',
      cpf: creditCardData.cpf || 'VAZIO',
      validade: creditCardData.validade || 'VAZIO',
      cvv: creditCardData.cvv ? '***' : 'VAZIO'
    });

    // Validar se todos os campos est√£o preenchidos
    const camposObrigatorios = ['numero', 'nome', 'cpf', 'validade', 'cvv'];
    const camposVazios = camposObrigatorios.filter(campo => !creditCardData[campo as keyof CreditCardData]);
    
    if (camposVazios.length > 0) {
      const erro = `‚ùå Preencha os seguintes campos do cart√£o: ${camposVazios.join(', ')}`;
      console.error(erro);
      throw new Error(`Preencha todos os campos do cart√£o de cr√©dito: ${camposVazios.join(', ')}`);
    }

    // Validar formato b√°sico
    if (creditCardData.numero.replace(/\s/g, '').length < 13) {
      const erro = '‚ùå N√∫mero do cart√£o deve ter pelo menos 13 d√≠gitos';
      console.error(erro);
      throw new Error('N√∫mero do cart√£o inv√°lido');
    }

    if (!creditCardData.validade.includes('/') || creditCardData.validade.length !== 5) {
      const erro = '‚ùå Validade deve estar no formato MM/AA';
      console.error(erro);
      throw new Error('Validade do cart√£o inv√°lida (use MM/AA)');
    }

    console.log('‚úÖ Dados do cart√£o validados com sucesso');
  }, []);

  return {
    validateFormData,
    validateCreditCardData
  };
};